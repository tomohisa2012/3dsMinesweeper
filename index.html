<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>3DS Minesweeper</title>
<style>
html, body { height: 100%; margin:0; padding:0; background:#151525; color:white; font-family: Arial; }
body { display: flex; flex-direction: column; align-items: center; justify-content: flex-start; }
h1 { margin: 10px; }
#topbar { background: #fff; color: #000; padding: 8px; font-size: 14px; width:100%; text-align:center; box-sizing:border-box; }
#boardWrapper { 
  background:#2a2a40; padding:10px; margin-top:10px; 
  display:inline-block; min-width: max-content; 
}
#board { display:inline-block; }
.row { height: 28px; }
.cell {
  width: 28px; height: 28px; border: 1px solid #333;
  display: inline-block; line-height: 28px; font-weight: bold;
  font-size: 16px; background: #3a3a55; cursor: pointer;
  vertical-align: top; box-sizing: border-box;
  text-align: center; /* Êï∞Â≠ó„Çí‰∏≠Â§Æ„Å´ */
}
.cell.revealed { background: #d0d0d0; color: black; }
button { margin: 3px; padding: 5px 8px; font-size: 12px; }
#flagButton.active { background-color: #ffcc00; color: black; }
#message { margin-top: 10px; font-size: 18px; color: yellow; background:#2a2a40; padding:5px 10px; display:inline-block; min-width:250px; min-height:24px; }
#restartBtn { margin-top: 10px; padding:5px 10px; font-size:14px; display:none; cursor:pointer; }
</style>
</head>
<body>

<h1>Minesweeper</h1>

<div id="topbar">
  Time: <span id="time">0</span>s„ÄÄ
  Mines: <span id="mineCount">0</span>„ÄÄ
  Score: <span id="score">0</span>
  <br>
  <button onclick="setDifficulty('easy')">Easy</button>
  <button onclick="setDifficulty('normal')">Normal</button>
  <button onclick="setDifficulty('hard')">Hard</button>
  <button id="flagButton" onclick="toggleFlag()">Flag Mode</button>
</div>

<div id="boardWrapper">
  <div id="board"></div>
</div>

<div id="message"> </div>
<button id="restartBtn" onclick="restartGame()">Restart</button>

<script>
var size=8, mines=10, board=[], score=0;
var flagsLeft=0, flagMode=false, firstClick=true, gameEnded=false;
var timer=0, interval=null;
var colors={1:"blue",2:"green",3:"red",4:"navy",5:"brown",6:"teal",7:"black",8:"gray"};
var audioCtx=null;

function playSound(type){
  try{
    if(!audioCtx) audioCtx=new (window.AudioContext||window.webkitAudioContext)();
    var osc=audioCtx.createOscillator();
    var gain=audioCtx.createGain();
    osc.connect(gain); gain.connect(audioCtx.destination);
    if(type==="open") osc.frequency.value=600;
    if(type==="flag") osc.frequency.value=300;
    if(type==="boom") osc.frequency.value=100;
    osc.start();
    gain.gain.setValueAtTime(0.2,audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+0.15);
    osc.stop(audioCtx.currentTime+0.15);
  }catch(e){}
}

function setDifficulty(level){
  if(level==="easy"){ size=8; mines=10; }
  else if(level==="normal"){ size=12; mines=20; }
  else if(level==="hard"){ size=16; mines=40; }
  init();
}

function toggleFlag(){
  flagMode=!flagMode;
  var btn=document.getElementById("flagButton");
  btn.className = flagMode ? "active" : "";
}

function init(){
  clearInterval(interval); timer=0;
  board=[]; score=0; flagsLeft=mines; firstClick=true; gameEnded=false;
  document.getElementById("score").innerHTML=score;
  document.getElementById("mineCount").innerHTML=flagsLeft;
  document.getElementById("time").innerHTML=timer;
  document.getElementById("message").innerHTML=" ";
  document.getElementById("restartBtn").style.display="none";

  var boardDiv=document.getElementById("board"); boardDiv.innerHTML="";
  for(var i=0;i<size;i++){
    board[i]=[];
    var row=document.createElement("div"); row.className="row";
    for(var j=0;j<size;j++){
      board[i][j]={mine:false,revealed:false,flag:false};
      var cell=document.createElement("div");
      cell.className="cell"; cell.dataset.x=i; cell.dataset.y=j;
      cell.onclick=clickCell;
      row.appendChild(cell);
    }
    boardDiv.appendChild(row);
  }
}

function placeMines(safeX,safeY){
  var placed=0;
  while(placed<mines){
    var x=Math.floor(Math.random()*size);
    var y=Math.floor(Math.random()*size);
    if(Math.abs(x-safeX)<=1 && Math.abs(y-safeY)<=1) continue;
    if(!board[x][y].mine){ board[x][y].mine=true; placed++; }
  }
}

function clickCell(){
  if(gameEnded) return;
  var x=parseInt(this.dataset.x);
  var y=parseInt(this.dataset.y);

  if(flagMode){
    if(!board[x][y].revealed){
      if(board[x][y].flag){ board[x][y].flag=false; this.innerHTML=""; flagsLeft++; }
      else if(flagsLeft>0){ board[x][y].flag=true; this.innerHTML="F"; flagsLeft--; playSound("flag"); }
      document.getElementById("mineCount").innerHTML=flagsLeft;
    }
    return;
  }

  if(board[x][y].revealed || board[x][y].flag) return;

  if(firstClick){
    placeMines(x,y); firstClick=false;
    interval=setInterval(function(){ timer++; document.getElementById("time").innerHTML=timer; },1000);
  }

  revealCell(x,y);
  checkWin();
}

function revealCell(x,y){
  if(x<0||y<0||x>=size||y>=size) return;
  if(board[x][y].revealed || board[x][y].flag) return;

  var cell=document.getElementsByClassName("row")[x].children[y];
  board[x][y].revealed=true; cell.className="cell revealed";

  if(board[x][y].mine){
    cell.innerHTML="X"; playSound("boom");
    document.getElementById("message").innerHTML="üí• Game Over!";
    gameEnded=true; clearInterval(interval);
    document.getElementById("restartBtn").style.display="inline-block";
    return;
  }

  var count=0;
  for(var i=-1;i<=1;i++){ for(var j=-1;j<=1;j++){
    var nx=x+i, ny=y+j;
    if(nx>=0&&nx<size && ny>=0&&ny<size){ if(board[nx][ny].mine) count++; }
  }}

  if(count>0){ cell.innerHTML=count; cell.style.color=colors[count]; }
  else{ for(var i=-1;i<=1;i++){ for(var j=-1;j<=1;j++){ revealCell(x+i,y+j); } } }

  score+=10; document.getElementById("score").innerHTML=score;
  playSound("open");
}

function checkWin(){
  var revealedCount=0;
  for(var i=0;i<size;i++){ for(var j=0;j<size;j++){ if(board[i][j].revealed) revealedCount++; } }
  if(revealedCount === size*size - mines){
    gameEnded=true; clearInterval(interval);
    var bonus = Math.max(0,50 - timer);
    score += bonus;
    document.getElementById("score").innerHTML = score;
    document.getElementById("message").innerHTML="üéâ You cleared the game! Score: "+score+" Time: "+timer+"s (Bonus: "+bonus+")";
    document.getElementById("restartBtn").style.display="inline-block";
  }
}

function restartGame(){ init(); }

init();
</script>

</body>
</html>