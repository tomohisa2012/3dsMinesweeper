<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>3DS Minesweeper - Time Mode</title>
<style>
body { margin:0; padding:0; background:#151525; color:white; font-family: Arial; text-align:center; }
h1 { margin:10px; }
#topbar { background:#fff; color:#000; padding:5px; font-size:14px; }
#gameWrapper { display:inline-block; background:#2a2a40; padding:10px; margin-top:10px; }
#board { display:block; margin:0 auto; }
.row { height:28px; }
.cell {
  width:28px; height:28px; border:1px solid #333;
  display:inline-block; line-height:28px; font-weight:bold;
  font-size:16px; background:#3a3a55; cursor:pointer;
  text-align:center; vertical-align:top;
}
.cell.revealed { background:#d0d0d0; color:black; }
button { margin:3px; padding:5px 8px; font-size:12px; }
#flagButton.active { background-color:#ffcc00; color:black; }
#message { margin-top:10px; font-size:18px; color:yellow; background:#2a2a40; padding:5px 10px; display:block; min-width:250px; min-height:24px; }
#restartBtn { margin-top:10px; padding:5px 10px; font-size:14px; display:none; cursor:pointer; }
#scoreboard { margin-top:10px; background:#3a3a55; padding:5px; min-width:200px; display:inline-block; text-align:left; }
#scoreboard h3 { margin:5px 0; font-size:14px; }
#scoreboard ul { margin:0; padding-left:20px; font-size:14px; }
</style>
</head>
<body>

<h1>Minesweeper - Time Mode</h1>

<div id="topbar">
Time: <span id="time">0</span>s„ÄÄ
Mines: <span id="mineCount">0</span>
<br>
<button onclick="setDifficulty('easy')">Easy</button>
<button onclick="setDifficulty('normal')">Normal</button>
<button onclick="setDifficulty('hard')">Hard</button>
<button id="flagButton" onclick="toggleFlag()">Flag Mode</button>
</div>

<div id="gameWrapper">
  <div id="board"></div>
  <div id="message"> </div>
  <button id="restartBtn" onclick="restartGame()">Restart</button>
  <div id="scoreboard"></div>
</div>

<script>
var size=8, mines=10, board=[];
var flagsLeft=0, flagMode=false, firstClick=true, gameEnded=false;
var timer=0, interval=null;
var colors={1:"blue",2:"green",3:"red",4:"navy",5:"brown",6:"teal",7:"black",8:"gray"};
var difficulty="easy";

function setDifficulty(level){
  difficulty=level;
  if(level==="easy"){ size=8; mines=10; }
  else if(level==="normal"){ size=12; mines=20; }
  else if(level==="hard"){ size=16; mines=40; }
  init();
}

function toggleFlag(){
  flagMode=!flagMode;
  document.getElementById("flagButton").className = flagMode ? "active" : "";
}

function init(){
  clearInterval(interval);
  timer=0;
  board=[]; flagsLeft=mines; firstClick=true; gameEnded=false;
  document.getElementById("time").innerHTML=timer;
  document.getElementById("mineCount").innerHTML=flagsLeft;
  document.getElementById("message").innerHTML=" ";
  document.getElementById("restartBtn").style.display="none";
  updateScoreboard();

  var boardDiv=document.getElementById("board"); boardDiv.innerHTML="";
  for(var i=0;i<size;i++){
    board[i]=[];
    var row=document.createElement("div"); row.className="row";
    for(var j=0;j<size;j++){
      board[i][j]={mine:false,revealed:false,flag:false};
      var cell=document.createElement("div");
      cell.className="cell"; cell.dataset.x=i; cell.dataset.y=j;
      cell.onclick=clickCell;
      row.appendChild(cell);
    }
    boardDiv.appendChild(row);
  }
}

function placeMines(safeX,safeY){
  var placed=0;
  while(placed<mines){
    var x=Math.floor(Math.random()*size);
    var y=Math.floor(Math.random()*size);
    if(Math.abs(x-safeX)<=1 && Math.abs(y-safeY)<=1) continue;
    if(!board[x][y].mine){ board[x][y].mine=true; placed++; }
  }
}

function startTimer(){
  interval=setInterval(function(){
    if(gameEnded) return;
    timer++;
    document.getElementById("time").innerHTML = timer;
  },1000);
}

function clickCell(){
  if(gameEnded) return;
  var x=parseInt(this.dataset.x);
  var y=parseInt(this.dataset.y);

  if(flagMode){
    if(!board[x][y].revealed){
      if(board[x][y].flag){ board[x][y].flag=false; this.innerHTML=""; flagsLeft++; }
      else if(flagsLeft>0){ board[x][y].flag=true; this.innerHTML="F"; flagsLeft--; }
      document.getElementById("mineCount").innerHTML=flagsLeft;
    }
    return;
  }

  if(board[x][y].revealed || board[x][y].flag) return;

  if(firstClick){
    placeMines(x,y);
    firstClick=false;
    startTimer();
  }

  revealCell(x,y);
  checkWin();
}

function revealCell(x,y){
  if(x<0||y<0||x>=size||y>=size) return;
  if(board[x][y].revealed || board[x][y].flag) return;

  var cell=document.getElementsByClassName("row")[x].children[y];
  board[x][y].revealed=true; cell.className="cell revealed";

  if(board[x][y].mine){
    cell.innerHTML="X";
    gameOver("üí• Game Over!");
    return;
  }

  var count=0;
  for(var i=-1;i<=1;i++){ for(var j=-1;j<=1;j++){
    var nx=x+i, ny=y+j;
    if(nx>=0&&nx<size && ny>=0&&ny<size){ if(board[nx][ny].mine) count++; }
  }}

  if(count>0){ cell.innerHTML=count; cell.style.color=colors[count]; }
  else{ for(var i=-1;i<=1;i++){ for(var j=-1;j<=1;j++){ revealCell(x+i,y+j); } } }
}

function checkWin(){
  var revealedCount=0;
  for(var i=0;i<size;i++){ for(var j=0;j<size;j++){ if(board[i][j].revealed) revealedCount++; } }
  if(revealedCount === size*size - mines){
    gameEnded=true; clearInterval(interval);
    document.getElementById("message").innerHTML="üéâ You cleared the game in "+timer+"s!";
    saveScore();
    updateScoreboard();
    document.getElementById("restartBtn").style.display="inline-block";
  }
}

function gameOver(msg){
  gameEnded=true; clearInterval(interval);
  document.getElementById("message").innerHTML = msg;
  document.getElementById("restartBtn").style.display="inline-block";
}

function restartGame(){ init(); }

function saveScore(){
  var boardKey = "ms_time_" + difficulty;
  var boardData = JSON.parse(localStorage.getItem(boardKey)) || [];
  boardData.push({time: timer, date: new Date().toLocaleDateString()});
  boardData.sort((a,b)=>a.time - b.time); // Â∞è„Åï„ÅÑÊôÇÈñìÈ†Ü
  boardData = boardData.slice(0,5); // ‰∏ä‰Ωç5‰ª∂
  localStorage.setItem(boardKey, JSON.stringify(boardData));
}

function updateScoreboard(){
  var boardKey = "ms_time_" + difficulty;
  var boardData = JSON.parse(localStorage.getItem(boardKey)) || [];
  var sbDiv = document.getElementById("scoreboard");
  sbDiv.innerHTML = "<h3>"+difficulty.toUpperCase()+" Best Times</h3><ul>" +
    boardData.map(e=>"Time: "+e.time+"s ("+e.date+")").join("") + "</ul>";
}

init();
</script>

</body>
</html>